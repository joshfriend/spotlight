<!-- Plugin Configuration File. Read more: https://plugins.jetbrains.com/docs/intellij/plugin-configuration-file.html -->
<idea-plugin>
  <id>com.fueledbycaffeine.spotlight</id>
  <name>Spotlight</name>
  <vendor url="https://github.com/joshfriend">Josh Friend</vendor>
  <description><![CDATA[
Spotlight lets you load smaller segments of your Gradle project in the IDE.
For use with the <a href="https://plugins.gradle.org/plugin/com.fueledbycaffeine.spotlight">Spotlight Gradle plugin</a>
]]></description>

  <depends>com.intellij.modules.platform</depends>
  <depends>com.intellij.gradle</depends>
  <depends optional="true" config-file="spotlight-json.xml">com.intellij.modules.json</depends>

  <resource-bundle>messages.SpotlightBundle</resource-bundle>

  <extensions defaultExtensionNs="com.intellij">
    <!-- Settings -->
    <applicationService serviceImplementation="com.fueledbycaffeine.spotlight.idea.settings.SpotlightSettings"/>
    <applicationConfigurable parentId="tools"
                             instance="com.fueledbycaffeine.spotlight.idea.settings.SpotlightConfigurable"
                             id="com.fueledbycaffeine.spotlight.settings"
                             displayName="Spotlight"/>
    
    <editorNotificationProvider implementation="com.fueledbycaffeine.spotlight.idea.notification.ProjectStaleNotificationProvider"/>
    <editorNotificationProvider implementation="com.fueledbycaffeine.spotlight.idea.notification.GradleSyncStaleNotificationProvider"/>
    <statusBarWidgetFactory implementation="com.fueledbycaffeine.spotlight.idea.ui.SpotlightStatusBarWidgetFactory"
                            id="com.fueledbycaffeine.spotlight"/>
    <directoryIndexExcludePolicy
            implementation="com.fueledbycaffeine.spotlight.idea.direxclude.SpotlightExcludeDirectoryPolicy"/>
    <externalProjectDataService implementation="com.fueledbycaffeine.spotlight.idea.gradle.SpotlightModelDataService"/>
    <externalSystemTaskNotificationListener implementation="com.fueledbycaffeine.spotlight.idea.gradle.GradleSyncStatusListener"/>
    
    <!-- Spotlight project files language support -->
    <fileType name="SpotlightProjects"
              implementationClass="com.fueledbycaffeine.spotlight.idea.lang.SpotlightProjectsFileType"
              language="SpotlightProjects"
              fileNames="ide-projects.txt;all-projects.txt"/>
    <fileTypeOverrider implementation="com.fueledbycaffeine.spotlight.idea.lang.SpotlightProjectsFileTypeOverrider" order="first"/>
    <lang.parserDefinition language="SpotlightProjects" implementationClass="com.fueledbycaffeine.spotlight.idea.lang.SpotlightProjectsParserDefinition"/>
    <lang.commenter language="SpotlightProjects" implementationClass="com.fueledbycaffeine.spotlight.idea.lang.SpotlightProjectsCommenter"/>
    
    <!-- Project path completion -->
    <completion.contributor language="SpotlightProjects" implementationClass="com.fueledbycaffeine.spotlight.idea.completion.SpotlightCompletionContributor"/>
    <completion.contributor language="Groovy" order="first" implementationClass="com.fueledbycaffeine.spotlight.idea.completion.SpotlightCompletionContributor"/>
    <completion.contributor language="kotlin" order="first" implementationClass="com.fueledbycaffeine.spotlight.idea.completion.SpotlightCompletionContributor"/>

    <!-- Project path validation and highlighting -->
    <annotator language="SpotlightProjects" implementationClass="com.fueledbycaffeine.spotlight.idea.annotator.SpotlightAnnotator"/>
    <annotator language="Groovy" implementationClass="com.fueledbycaffeine.spotlight.idea.annotator.SpotlightAnnotator"/>
    <annotator language="kotlin" implementationClass="com.fueledbycaffeine.spotlight.idea.annotator.SpotlightAnnotator"/>
    
    <!-- Navigation support for ide-projects.txt -->
    <gotoDeclarationHandler implementation="com.fueledbycaffeine.spotlight.idea.lang.IdeProjectsGotoDeclarationHandler"/>
    <psi.referenceContributor language="SpotlightProjects" implementation="com.fueledbycaffeine.spotlight.idea.lang.IdeProjectsReferenceContributor"/>
    
    <!-- Navigation support for build.gradle project references -->
    <psi.referenceContributor language="Groovy" implementation="com.fueledbycaffeine.spotlight.idea.gradle.BuildGradleProjectReferenceContributor"/>
    <psi.referenceContributor language="kotlin" implementation="com.fueledbycaffeine.spotlight.idea.gradle.BuildGradleProjectReferenceContributor"/>
    <gotoDeclarationHandler implementation="com.fueledbycaffeine.spotlight.idea.gradle.BuildGradleProjectGotoHandler"/>
    
    <!-- Suppress built-in inspections in spotlight project files -->
    <lang.inspectionSuppressor language="SpotlightProjects" implementationClass="com.fueledbycaffeine.spotlight.idea.lang.SpotlightInspectionSuppressor"/>

    <notificationGroup id="Spotlight" displayType="BALLOON"/>

    <!-- Search Everywhere contributor for Gradle project paths -->
    <searchEverywhereContributor implementation="com.fueledbycaffeine.spotlight.idea.search.GradleProjectSearchContributorFactory"/>
  </extensions>

  <extensions defaultExtensionNs="org.jetbrains.plugins.gradle">
    <projectResolve implementation="com.fueledbycaffeine.spotlight.idea.gradle.SpotlightProjectResolverExtension"/>
  </extensions>

  <projectListeners>
    <listener class="com.fueledbycaffeine.spotlight.idea.listener.SpotlightProjectsListAutoSaveListener"
              topic="com.intellij.openapi.fileEditor.FileEditorManagerListener"/>
  </projectListeners>

  <actions>
    <group id="Group.SpotlightWorkspace"
           description="Add or Remove Spotlight projects"
           text="Add or Remove Spotlight Projects">
      <separator/>
      <action class="com.fueledbycaffeine.spotlight.idea.action.AddProjectToSpotlightAction"
              id="Action.AddProjectToSpotlight"
              text="Add Project to Spotlight">
        <keyboard-shortcut first-keystroke="control shift J" keymap="$default"/>
      </action>
      <action class="com.fueledbycaffeine.spotlight.idea.action.RemoveProjectFromSpotlightAction"
              id="Action.RemoveProjectFromSpotlight"
              text="Remove Project from Spotlight">
        <keyboard-shortcut first-keystroke="control shift F" keymap="$default"/>
      </action>
      <separator/>
      <add-to-group group-id="ProjectViewPopupMenu"/>
    </group>
    
    <action class="com.fueledbycaffeine.spotlight.idea.lang.RemoveAllInvalidPathsAction"
            id="Action.RemoveAllInvalidPaths"
            text="Remove All Invalid Paths">
      <keyboard-shortcut first-keystroke="control alt O" keymap="$default"/>
    </action>
  </actions>
</idea-plugin>
